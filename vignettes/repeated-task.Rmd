---
title: "repeated-task"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{repeated-task}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Consider a conjoint survey with $n$ tasks. We recommend that researchers include a task $n+1$ that duplicates their first task, but with the order of profiles reversed, in order to measure intra-respondent reliability $\tau$. Our project website specifies how to set up this repeated task in Qualtrics, but this script discusses how to analyze data from such a conjoint study.

First read the data and inspect it:
```{r setup}
library(projoint)

data("exampleData1")
head(exampleData1)
```

This data frame is the result of a raw data set processed with the \texttt{read_Qualtrics} function. Next we reshape it by specifying the variable indicating respondent IDs and the variables containing outcomes. Optional arguments allow users to specify that the repeated task is in the same order as the original rather than flipped, which defaults to TRUE. The \texttt{.alphabet} argument specifies the letter indicating attributes and levels, which defaults to \texttt{F} if using Anton Strezhnev's tool for designing conjoint surveys in Qualtrics.

```{r reshape}
reshaped_data = reshape_conjoint(exampleData1, .idvar = "ResponseId",
                                 .outcomes = c("Q4.1", "Q5.1", "Q6.1", "Q7.1", "Q8.1", 
                                               "Q9.1"),
                                 .alphabet ="A")

``` 

To estimate marginal means (MMs) from this data set, we use the \texttt{pj} function:

```{r estimate}
results = pj(reshaped_data)
```